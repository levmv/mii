# Router

Для роутинга есть встроенный компонент (/core/Router), включенный по-умолчанию.

Роутер решает сразу несколько задач. Основная: определить по текущему адресу запроса — конкретный контролер, экшен и сопутствующие параметры.
Дополнительная: для именованных роутов можно выполнить обратный процесс. По имени роута и дополнительным параметрам составить URL.

 
Конфигурация роутера выглядит примерно так:
```php
'components' => [
    'router' => [
    
        'suffix' => '.html', // default: null
        
        'cache' => false, 
        
        'default_parameters' => [
            'id' => '[0-9]+',
            'slug' => '[a-zA-Z0-9-_.]+',
            'path' => '[a-zA-Z0-9-_./]+'
        ],
    
        'order' => [   // default: null
            'app\controllers',
            'some\controllers'
        ],
    
        'routes' => [
            'app\controllers' => [
                
                '/' => 'main',
                'page/{slug}' => 'page:show',
                'foo(/{action})' => 'bar',
                
                'id{id}' => [
                    'name' => 'user',
                    'path' => 'user:profile',
                ],
                
                'news(/{category}(/page/({id})))' => [
                    'path' => 'news:category',
                    'params' => [
                        'category' => '[a-zA-Z-]+',
                        'page' => '[0-9]+',
                    ]
                ]
                
            
            ],
            'some\controllers' => [
                ...
            ]
        ]
    ]
]
```


Сами роуты задаются в 'routes', разделенные на группы по имени основного namespace'а. В большинстве случаев такая группа
ровно одна и указывает на основное местоположение контроллеров (обычно /app/controllers). 

Поиск всегда производится последовательно до первого совпадения.

В случае если групп роутов большой одной, в параметре order можно перечислить порядок, в котором должен производиться поиск
по группам.

Каждая группа представляет из себя ассоциативный массив, где ключом является паттерн. Паттерн это то, с чем сравнивается
текущий адрес. Паттерн является простой строкой, которую роутер конвертирует в регулярное выражение.

Каждый паттерн должен являться уникальной строкой, два роута с одинаковыми паттернами недопустимы.

В паттерне допускается использовать опциональные части, которые обозначаются круглыми скобками. Так, под роут ```foo/(<action>)```
подойдут, например, такие адреса:
```
/foo
/foo/somename
```

Так же в паттернах можно использовать именованные параметры. Эти параметры в последствие передаются в экшен. Есть два стандартных
именованных параметра: ```{controller}``` и ```{action}```, которые обозначают, как уже понятно, имя контроллера и имя экшена. В остальном, параметры
можно задавать произвольно.

Есть несколько простых параметров, для которых по-умолчанию уже заданы регулярные выражения:
```
 protected $default_parameters = [
        'id' => '[0-9]+',
        'slug' => '[a-zA-Z0-9-_.]+',
        'path' => '[a-zA-Z0-9-_./]+'
    ];
```
Для любых других параметров регулярки надо задавать самостоятельно.
     
Значением в ассоциативном массиве, где ключ это паттерн, является путь. Путь указывает какой контролер и какой экшен нужно
выполнить. Для контроллера нужно указывать полное имя относительно основного namespace'а (имени группы). Так, если у нас 
есть контроллер `app\controllers\admin\Pages` и группа роутов `app\controllers`, то путь к контролеру будет: `admin\pages`.
Экшены указываются через двоеточие. Если экшен не указан, то экшен по-умолчанию: index.

Если для роута необходимо задать именованные параметры или другие настройки, то вместо пути, паттерну назначается еще один массив.
Путь в данном случае указывается в параметре ```path```. Именованные параметры в ```params```.
 
 ### Именованные роуты
 
С помощью метода Mii::$app->router->url() или сокращенной функции url() можно произвести обратную операцию: сгенерировать url на основе
имени роута и набора параметров.

Для этого можно использовать параметр path роута. Например, если есть такой роут:
```
 'page/{slug}' => 'page:show'
```
то вызов ```url('page:show', ['slug' => 'foobar']);``` сгенерирует следующий адрес: ```/page/foobar```

При совпадении пути у разных роутов — при генерации будет использован первый найденный роут.

Но, лучше использовать не путь роута, а отдельное имя. Каждому роуту можно дать произвольное имя.
```
 'page/{slug}' => [
    'path' => 'page:show',
    'name' => 'page' 
 ]
``` 

```
    url('page', ['slug' => 'foobar']);
```
    
    
 